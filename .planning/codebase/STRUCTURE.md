# Codebase Structure

**Analysis Date:** 2026-01-08

## Directory Layout

```
ResQTerra-Engine/
├── Cargo.toml              # Workspace root (edge-device package)
├── README.md               # Project overview
├── .gitignore              # Git exclusions
├── docs/
│   └── PROPOSAL.md         # Technical proposal (1000+ lines)
├── src/                    # Edge device source
│   ├── main.rs             # Entry point: main loop, transport fallback
│   ├── protocol.rs         # Protobuf message definitions
│   └── transport/
│       ├── mod.rs          # Module exports
│       ├── five_g.rs       # 5G transport (TCP to :8080)
│       └── bluetooth.rs    # Bluetooth transport (TCP to :9000)
├── relay-node/             # Relay node application
│   ├── Cargo.toml          # Package manifest
│   └── src/
│       └── main.rs         # TCP proxy: listen :9000, forward :8080
├── server/                 # Backend server application
│   ├── Cargo.toml          # Package manifest
│   └── src/
│       └── main.rs         # Data sink: listen :8080, decode, log
└── .planning/              # Planning documents (generated)
    └── codebase/           # Codebase analysis docs
```

## Directory Purposes

**src/**
- Purpose: Edge device application (primary component)
- Contains: Main entry point, protocol definitions, transport implementations
- Key files: `main.rs` (orchestration), `protocol.rs` (encoding), `transport/*.rs` (network)
- Subdirectories: `transport/` for network abstraction layer

**src/transport/**
- Purpose: Pluggable transport abstraction layer
- Contains: 5G and Bluetooth transport implementations
- Key files: `five_g.rs` (TCP:8080), `bluetooth.rs` (TCP:9000), `mod.rs` (exports)
- Subdirectories: None

**relay-node/**
- Purpose: Store-and-forward relay proxy
- Contains: TCP listener and forwarding logic
- Key files: `src/main.rs` (listen :9000, proxy to :8080)
- Subdirectories: `src/` for source code

**server/**
- Purpose: Backend data ingestion server
- Contains: TCP listener and protobuf decoder
- Key files: `src/main.rs` (listen :8080, decode, log)
- Subdirectories: `src/` for source code

**docs/**
- Purpose: Technical documentation
- Contains: Design proposals, specifications
- Key files: `PROPOSAL.md` (comprehensive 1000+ line spec)
- Subdirectories: None

## Key File Locations

**Entry Points:**
- `src/main.rs` - Edge device entry point
- `relay-node/src/main.rs` - Relay node entry point
- `server/src/main.rs` - Server entry point

**Configuration:**
- `Cargo.toml` - Root workspace manifest
- `relay-node/Cargo.toml` - Relay node dependencies
- `server/Cargo.toml` - Server dependencies
- `.gitignore` - Git exclusions

**Core Logic:**
- `src/protocol.rs` - SensorPacket definition, encode/decode
- `src/transport/five_g.rs` - 5G network transport
- `src/transport/bluetooth.rs` - Bluetooth fallback transport
- `src/transport/mod.rs` - Transport module exports

**Testing:**
- None (no test files currently)

**Documentation:**
- `README.md` - User-facing project overview
- `docs/PROPOSAL.md` - Technical design specification

## Naming Conventions

**Files:**
- snake_case.rs for Rust modules (`protocol.rs`, `five_g.rs`)
- mod.rs for module manifests
- main.rs for binary entry points
- UPPERCASE.md for important docs (README.md, PROPOSAL.md)

**Directories:**
- kebab-case for packages (`relay-node/`, `server/`)
- snake_case for modules (`transport/`)
- Plural not used (no `transports/`, just `transport/`)

**Special Patterns:**
- `mod.rs` re-exports submodules
- Binary packages have `src/main.rs` only (no lib.rs)

## Where to Add New Code

**New Transport Type:**
- Implementation: `src/transport/{name}.rs`
- Export: Add `pub mod {name};` to `src/transport/mod.rs`
- Integration: Update fallback logic in `src/main.rs`

**New Protocol Message:**
- Definition: Add struct to `src/protocol.rs`
- Usage: Update `src/main.rs` to create/send new message type

**New Binary Component:**
- Directory: Create `{component-name}/` with `Cargo.toml` and `src/main.rs`
- Workspace: Add to workspace members in root `Cargo.toml`

**Shared Library (Future):**
- Location: Create `common/` or `lib/` directory
- Protocol sharing: Move `src/protocol.rs` to shared crate

**Tests:**
- Unit tests: Add `#[cfg(test)]` module at bottom of implementation file
- Integration tests: Create `tests/` directory at package root

## Special Directories

**.planning/**
- Purpose: Claude-generated planning and analysis documents
- Source: Auto-generated by codebase mapping
- Committed: Yes (useful for context)

**target/** (gitignored)
- Purpose: Cargo build artifacts
- Source: Generated by `cargo build`
- Committed: No (in `.gitignore`)

---

*Structure analysis: 2026-01-08*
*Update when directory structure changes*
